# 公告区域遗留物品检测

       随着科学技术的快速发展以及信息技术的日渐完善，人们为了提高生活质量，对高科技的便捷性、安全性、高效性的要求变得越来越

高。自从美国“9.11”事件发生之后，反恐成为了各个国家安全工作的重中之重，加强对不安全因素的防范措施、给人们提供一个安全的

生活环境、从最大程度上打击恐怖行动已经成了全世界各个国家非常重视的安全问题。尤其在人口流动量比较大的场所，安全问题更是不

容忽视的问题。以机场为例，目前中国国内有160多个正在使用的机场，并且随着中国经济的飞速发展，机场的人流量以及货物运送量逐

渐增加，广州的白云机场、北京的首都机场、上海的浦东机场的每年的客运量以千万计，在这种人口高度密集的环境下，安全工作就突显

的非常重要。所以对于人口密集的公共场所和一些安全级别较高的单位和部门进行实时的、全天候的监控关注场所的异常情况就显得特别

重要。而遗留包裹作为恐怖袭击的主要方式得到越来越多的关注，原来的监控系统已经无法满足人们的需求。为了有效地保证公告场所的

安全，包裹遗留物智能视频监控系统应运而生。项目利用图像识别方法，应用Atlas 800-9000设计了一套专门针对于公告区域遗留物包裹

检测的算法方案，可实时预警公共场所内是否出现遗留物品，当发现视频画面内出现遗留物品时，系统触发告警提示。

       本题目分为训练和推理两部分内容，训练是在modelarts平台上进行的训练，训练的模型包括两个，一个是识别人的模型，一个是识

别物品的模型。推理是在modelarts上通过训练任务进行推理。

### 物品数据集
链接：https://pan.baidu.com/s/1Ub8uFFKn-Y-TdKoXkhlslw 
提取码：t4hw

### 人数据集
链接：https://pan.baidu.com/s/1W-sVioDTjMEY8xX4kC4fhg 
提取码：osqr


### 训练-人的模型
* 1.将人数据集/person目录下的所有文件上传到obs指定目录obs://coco-gambler/626datasets/person/下中。

![Alt](http://49.234.146.126/2.png)

* 2.然后将新建文件夹/YOLOv5目录下的代码文件上传到obs指定目录obs://coco-gambler/YOLOv5/目录下。

![Alt](http://49.234.146.126/3.png)

* 3.然后创建算法，算法的具体属性需要指定代码文件夹和启动代码文件为train_start.py。

![Alt](http://49.234.146.126/1.png)

* 4.接下来执行在算法中创建训练作业，data_url指定的是第一步中obs路径obs://coco-gambler/626datasets/person/，resume_yolov5指定的是yolov5模型的权重，然后再模型输出的时候我们只需要指定output_dir为模型输出路径/coco-gambler/626/person-three/。

![Alt](http://49.234.146.126/4.png)

* 5.然后执行训练作业就行。

** 6.如果遇到训练的loss不收敛的情况，可以增大batch_size到32。

### 训练-物品的模型

* 1.将物品数据集wuping1目录下的所有文件上传到obs指定目录obs://coco-gambler/626datasets/wuping1/下中。

![Alt](http://49.234.146.126/5.png)

* 2.后面的步骤和之前对人进行训练的步骤完全一样。

* 3.然后执行训练作业就行。

** 4.如果遇到训练的loss不收敛的情况，可以增大batch_size到32，或者调高学习率lr。






### 推理-公共区域遗留物品识别推理

由于modelarts的在线部署并没有提供视频接口，所以必须使用创建训练作业的方式来执行推理任务。整个推理流程可以用下面三张图来解释。

![Alt](http://49.234.146.126/整体流程图.png)

距离阈值的判断条件：

![Alt](http://49.234.146.126/距离阈值判断.jpg)

时间阈值的判断条件：

![Alt](http://49.234.146.126/时间阈值判断.png)
* 1.上传训练的ckpt模型文件和输入视频到obs指定位置。

![Alt](http://49.234.146.126/6.png)
* 2.在代码中指定ckpt模型和输入视频在obs桶中的位置并将其移动到modelarts临时目录下。

![Alt](http://49.234.146.126/7.png)
* 3.在marks1和marks2指定输入的视频的帧宽度和高度。

![Alt](http://49.234.146.126/8.png)
* 4.在cv2向输出视频的writer写出的时候指定帧宽度和高度。

![Alt](http://49.234.146.126/9.png)
* 5.将modelarts临时目录下输出的视频文件传回obs。

![Alt](http://49.234.146.126/10.png)
* 6.然后创建算法，算法的具体属性需要指定代码文件夹和启动代码文件为ceshi6.py。

![Alt](http://49.234.146.126/11.png)
* 7.创建训练作业时，不需要额外的输入，直接创建训练作业即可。
